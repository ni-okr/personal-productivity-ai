#!/bin/bash

# üëÄ –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ñ–æ–Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö –∏ –∫–æ–º–º–∏—Ç–∞—Ö

echo "üëÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ñ–æ–Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"
echo "=============================================="
echo "–ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"
echo ""

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
update_status() {
    clear
    echo "üëÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ñ–æ–Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏"
    echo "=============================================="
    echo "–í—Ä–µ–º—è: $(date)"
    echo ""
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
    ./.cursor/update-agent-status.sh > /dev/null 2>&1
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Ç–∫–∏–π —Å—Ç–∞—Ç—É—Å
    echo "üìä –ö—Ä–∞—Ç–∫–∏–π —Å—Ç–∞—Ç—É—Å:"
    if npm test --silent > /dev/null 2>&1; then
        echo "  üß™ –¢–µ—Å—Ç—ã: ‚úÖ –ü—Ä–æ—Ö–æ–¥—è—Ç"
    else
        echo "  üß™ –¢–µ—Å—Ç—ã: ‚ùå –ï—Å—Ç—å –æ—à–∏–±–∫–∏ (–∞–≥–µ–Ω—Ç—ã –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç)"
    fi
    
    if npm run build --silent > /dev/null 2>&1; then
        echo "  üèóÔ∏è –°–±–æ—Ä–∫–∞: ‚úÖ –ü—Ä–æ—Ö–æ–¥–∏—Ç"
    else
        echo "  üèóÔ∏è –°–±–æ—Ä–∫–∞: ‚ùå –ï—Å—Ç—å –æ—à–∏–±–∫–∏ (–∞–≥–µ–Ω—Ç—ã –∏—Å–ø—Ä–∞–≤–ª—è—é—Ç)"
    fi
    
    echo ""
    echo "üìà –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–∏—Ç—ã:"
    git log --oneline -3 --grep="fix:" --grep="feat:" --grep="test:" | head -3
    
    echo ""
    echo "üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ —Ç–µ—Å—Ç–æ–≤..."
    echo "  - tests/unit/"
    echo "  - tests/integration/"
    echo "  - jest.config.js"
    echo "  - jest.setup.js"
    
    echo ""
    echo "üí° –ê–≥–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!"
    echo "   –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ —Ñ–∞–π–ª–∞—Ö –∏ –∫–æ–º–º–∏—Ç–∞—Ö."
}

# –ó–∞–ø—É—Å–∫–∞–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
while true; do
    update_status
    sleep 10
done
