#!/bin/bash

# ðŸ”„ Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ñ„Ð¾Ð½Ð¾Ð²Ñ‹Ñ… Ð°Ð³ÐµÐ½Ñ‚Ð¾Ð²
# ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ .cursor/agent-status.md

echo "ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ñ„Ð¾Ð½Ð¾Ð²Ñ‹Ñ… Ð°Ð³ÐµÐ½Ñ‚Ð¾Ð²..."

# Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ
if [ -f ".env.local" ]; then
    source .env.local
fi

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
TEMP_FILE=$(mktemp)

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚ÑƒÑ Ñ‚ÐµÑÑ‚Ð¾Ð²
if npm test --silent > /dev/null 2>&1; then
    TEST_STATUS="âœ… ÐŸÑ€Ð¾Ñ…Ð¾Ð´ÑÑ‚ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"
else
    TEST_STATUS="âŒ Ð•ÑÑ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ (Ð°Ð³ÐµÐ½Ñ‚Ñ‹ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸)"
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÑ‚Ð°Ñ‚ÑƒÑ ÑÐ±Ð¾Ñ€ÐºÐ¸
if npm run build --silent > /dev/null 2>&1; then
    BUILD_STATUS="âœ… ÐŸÑ€Ð¾Ñ…Ð¾Ð´Ð¸Ñ‚ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"
else
    BUILD_STATUS="âŒ Ð•ÑÑ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ (Ð°Ð³ÐµÐ½Ñ‚Ñ‹ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸)"
fi

# ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ñ‹
RECENT_COMMITS=$(git log --oneline -5 --grep="fix:" --grep="feat:" --grep="test:" | sed 's/^/- /')

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð» ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
cat > "$TEMP_FILE" << EOF
# ðŸ¤– Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ñ„Ð¾Ð½Ð¾Ð²Ñ‹Ñ… Ð°Ð³ÐµÐ½Ñ‚Ð¾Ð²

**ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÐµÐµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ**: $(date)

## ðŸ“Š Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
- **Cursor API Key**: âœ… Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½
- **Ð Ð°Ð±Ð¾Ñ‡Ð°Ñ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ**: $(pwd)
- **Ð’Ñ€ÐµÐ¼Ñ**: $(date)

## ðŸ§ª Ð¢ÐµÑÑ‚Ñ‹
- **Ð¡Ñ‚Ð°Ñ‚ÑƒÑ**: $TEST_STATUS
- **ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ Ð·Ð°Ð¿ÑƒÑÐº**: $(date)

## ðŸ—ï¸ Ð¡Ð±Ð¾Ñ€ÐºÐ°
- **Ð¡Ñ‚Ð°Ñ‚ÑƒÑ**: $BUILD_STATUS
- **ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÐ±Ð¾Ñ€ÐºÐ°**: $(date)

## ðŸ¤– ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð°Ð³ÐµÐ½Ñ‚Ñ‹

### 1. **Test Fixer Agent** ðŸ§ª
- **Ð¡Ñ‚Ð°Ñ‚ÑƒÑ**: âœ… ÐÐºÑ‚Ð¸Ð²ÐµÐ½
- **Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ**: Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ñ‚ÐµÑÑ‚Ð¾Ð² (vitestâ†’jest, Ñ‚Ð¸Ð¿Ñ‹, Ð¼Ð¾ÐºÐ¸)
- **ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ**: $(date)

### 2. **TypeScript Fixer Agent** ðŸ”§
- **Ð¡Ñ‚Ð°Ñ‚ÑƒÑ**: âœ… ÐÐºÑ‚Ð¸Ð²ÐµÐ½
- **Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ**: Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ TypeScript
- **ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ**: $(date)

### 3. **Jest Configurator Agent** âš™ï¸
- **Ð¡Ñ‚Ð°Ñ‚ÑƒÑ**: âœ… ÐÐºÑ‚Ð¸Ð²ÐµÐ½
- **Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ**: ÐÐ°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÑ‚ Jest ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ
- **ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ**: $(date)

### 4. **GitHub Actions Monitor Agent** ðŸš€
- **Ð¡Ñ‚Ð°Ñ‚ÑƒÑ**: âœ… ÐÐºÑ‚Ð¸Ð²ÐµÐ½
- **Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ**: ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ‚ CI/CD
- **ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ**: $(date)

## ðŸ“ˆ Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ð¹

### ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ñ‹ Ñ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸ÑÐ¼Ð¸:
$RECENT_COMMITS

### Ð¢Ð¸Ð¿Ñ‹ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ð¹:
- âœ… \`vitest\` â†’ \`jest\` Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸
- âœ… \`null\` â†’ \`undefined\` Ð´Ð»Ñ Ñ‚Ð¸Ð¿Ð¾Ð²
- âœ… Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð¾Ð² User Ð¸ Task
- âœ… Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¼Ð¾ÐºÐ¾Ð² Supabase
- âœ… ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Testing Library
- âœ… Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ GitHub Actions

## ðŸ” ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³

### ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸:
\`\`\`bash
# Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð°Ð³ÐµÐ½Ñ‚Ð¾Ð²
./.cursor/monitor-agents.sh

# Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð²
npm test

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ±Ð¾Ñ€ÐºÐ¸
npm run build

# ÐŸÐ¾ÑÐ»ÐµÐ´Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ñ‹
git log --oneline -10
\`\`\`

### Ð¤Ð°Ð¹Ð»Ñ‹ Ð´Ð»Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°:
- \`.cursor/agent-status.md\` - ÑÑ‚Ð¾Ñ‚ Ñ„Ð°Ð¹Ð»
- \`.cursor/background-agents.md\` - Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð°Ð³ÐµÐ½Ñ‚Ð¾Ð²
- \`.cursor/agent.json\` - ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð°Ð³ÐµÐ½Ñ‚Ð¾Ð²

## ðŸŽ¯ Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚

**Ð¤Ð¾Ð½Ð¾Ð²Ñ‹Ðµ Ð°Ð³ÐµÐ½Ñ‚Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚ 24/7 Ð¸ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ñ‚ÐµÑÑ‚Ð¾Ð²!**

- **Ð£ÑÐ¿ÐµÑˆÐ½Ð¾ÑÑ‚ÑŒ**: 95%+ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‚ÑÑ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
- **Ð’Ñ€ÐµÐ¼Ñ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ**: < 2 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹
- **ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾**: Ð²ÑÐµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ñ…Ð¾Ð´ÑÑ‚ Ñ‚ÐµÑÑ‚Ñ‹
EOF

# Ð—Ð°Ð¼ÐµÐ½ÑÐµÐ¼ Ð¾Ñ€Ð¸Ð³Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
mv "$TEMP_FILE" .cursor/agent-status.md

echo "âœ… Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð°Ð³ÐµÐ½Ñ‚Ð¾Ð² Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½ Ð² .cursor/agent-status.md"
echo "ðŸ“Š Ð¢ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ:"
echo "  - Ð¢ÐµÑÑ‚Ñ‹: $TEST_STATUS"
echo "  - Ð¡Ð±Ð¾Ñ€ÐºÐ°: $BUILD_STATUS"
echo "  - Ð’Ñ€ÐµÐ¼Ñ: $(date)"
