// ðŸ§ª Unit Ñ‚ÐµÑÑ‚Ñ‹ Ð´Ð»Ñ mock Ñ€ÐµÐ¶Ð¸Ð¼Ð° Ð·Ð°Ð´Ð°Ñ‡
import {
    addMockTask,
    clearMockTasks,
    getMockTasksByUser,
    mockCompleteTask,
    mockCreateTask,
    mockDeleteTask,
    mockGetAISuggestions,
    mockGetProductivityMetrics,
    mockGetTasks,
    mockGetTasksStats,
    mockSyncTasks,
    mockUpdateTask,
    updateMockTasks
} from '@/lib/tasks-mock'
import { CreateTaskData, Task, UpdateTaskData } from '@/types'

// Mock console.log Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð»Ð¾Ð³Ð¾Ð²
let mockConsoleLog: jest.SpyInstance

describe('Tasks Mock Functions', () => {
    const mockUserId = 'mock-user-1'
    const mockTaskData: CreateTaskData = {
        title: 'Test Task',
        description: 'Test Description',
        priority: 'medium',
        estimatedMinutes: 30,
        tags: ['test', 'mock']
    }

    beforeEach(() => {
        clearMockTasks()
        mockConsoleLog = jest.spyOn(console, 'log').mockImplementation()
    })

    afterEach(() => {
        mockConsoleLog.mockRestore()
    })

    describe('mockGetTasks', () => {
        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð¿ÑƒÑÑ‚Ð¾Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ð·Ð°Ð´Ð°Ñ‡ Ð´Ð»Ñ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ', async () => {
            const result = await mockGetTasks(mockUserId)

            expect(result.success).toBe(true)
            expect(result.tasks).toEqual([])
            expect(result.message).toBe('Mock Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾')
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð»Ñ ÑƒÐºÐ°Ð·Ð°Ð½Ð½Ð¾Ð³Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ', async () => {
            // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð´Ð»Ñ Ñ€Ð°Ð·Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
            addMockTask({
                id: 'task-1',
                title: 'Task 1',
                description: 'Description 1',
                priority: 'high',
                status: 'todo',
                estimatedMinutes: 30,
                source: 'manual',
                tags: ['test'],
                userId: mockUserId,
                createdAt: new Date(),
                updatedAt: new Date()
            })

            addMockTask({
                id: 'task-2',
                title: 'Task 2',
                description: 'Description 2',
                priority: 'medium',
                status: 'todo',
                estimatedMinutes: 45,
                source: 'manual',
                tags: ['test'],
                userId: 'other-user',
                createdAt: new Date(),
                updatedAt: new Date()
            })

            const result = await mockGetTasks(mockUserId)

            expect(result.success).toBe(true)
            expect(result.tasks).toHaveLength(1)
            expect(result.tasks[0].id).toBe('task-1')
            expect(result.tasks[0].userId).toBe(mockUserId)
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', async () => {
            await mockGetTasks(mockUserId)

            // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð±ÐµÐ· Ð¾ÑˆÐ¸Ð±Ð¾Ðº
            expect(true).toBe(true)
        })
    })

    describe('mockCreateTask', () => {
        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²ÑƒÑŽ Ð·Ð°Ð´Ð°Ñ‡Ñƒ', async () => {
            const result = await mockCreateTask(mockUserId, mockTaskData)

            expect(result.success).toBe(true)
            expect(result.task).toBeDefined()
            expect(result.task?.title).toBe(mockTaskData.title)
            expect(result.task?.description).toBe(mockTaskData.description)
            expect(result.task?.priority).toBe(mockTaskData.priority)
            expect(result.task?.status).toBe('todo')
            expect(result.task?.userId).toBe(mockUserId)
            expect(result.task?.id).toMatch(/^mock-task-\d+-[a-z0-9]+$/)
            expect(result.message).toBe('Mock Ð·Ð°Ð´Ð°Ñ‡Ð° ÑÐ¾Ð·Ð´Ð°Ð½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾')
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð² ÑÐ¿Ð¸ÑÐ¾Ðº mock Ð·Ð°Ð´Ð°Ñ‡', async () => {
            const result = await mockCreateTask(mockUserId, mockTaskData)

            const userTasks = getMockTasksByUser(mockUserId)
            expect(userTasks).toHaveLength(1)
            expect(userTasks[0].id).toBe(result.task?.id)
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ‚ÐºÐ¸', async () => {
            const beforeCreate = new Date()
            const result = await mockCreateTask(mockUserId, mockTaskData)
            const afterCreate = new Date()

            expect(result.task?.createdAt).toBeInstanceOf(Date)
            expect(result.task?.updatedAt).toBeInstanceOf(Date)
            expect(result.task?.createdAt.getTime()).toBeGreaterThanOrEqual(beforeCreate.getTime())
            expect(result.task?.createdAt.getTime()).toBeLessThanOrEqual(afterCreate.getTime())
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', async () => {
            await mockCreateTask(mockUserId, mockTaskData)

            expect(mockConsoleLog).toHaveBeenCalledWith(
                'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð±ÐµÐ· Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº Supabase'
            )
        })
    })

    describe('mockUpdateTask', () => {
        let taskId: string

        beforeEach(async () => {
            const result = await mockCreateTask(mockUserId, mockTaskData)
            taskId = result.task?.id || ''
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ Ð·Ð°Ð´Ð°Ñ‡Ñƒ', async () => {
            const updates: UpdateTaskData = {
                title: 'Updated Task',
                description: 'Updated Description',
                priority: 'high'
            }

            const result = await mockUpdateTask(taskId, updates)

            expect(result.success).toBe(true)
            expect(result.task?.title).toBe(updates.title)
            expect(result.task?.description).toBe(updates.description)
            expect(result.task?.priority).toBe(updates.priority)
            expect(result.message).toBe('Mock Ð·Ð°Ð´Ð°Ñ‡Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾')
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¼ÐµÑ‚ÐºÑƒ updatedAt', async () => {
            const originalUpdatedAt = getMockTasksByUser(mockUserId)[0].updatedAt

            // Ð–Ð´ÐµÐ¼ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð²Ñ€ÐµÐ¼Ñ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ð»Ð¾ÑÑŒ
            await new Promise(resolve => setTimeout(resolve, 10))

            const updates: UpdateTaskData = { title: 'Updated Title' }
            await mockUpdateTask(taskId, updates)

            const updatedTask = getMockTasksByUser(mockUserId)[0]
            expect(updatedTask.updatedAt.getTime()).toBeGreaterThan(originalUpdatedAt.getTime())
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÑƒ Ð´Ð»Ñ Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸', async () => {
            const updates: UpdateTaskData = { title: 'Updated Title' }
            const result = await mockUpdateTask('non-existent-id', updates)

            expect(result.success).toBe(false)
            expect(result.error).toBe('Ð—Ð°Ð´Ð°Ñ‡Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°')
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', async () => {
            const updates: UpdateTaskData = { title: 'Updated Title' }
            await mockUpdateTask(taskId, updates)

            expect(mockConsoleLog).toHaveBeenCalledWith(
                'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð±ÐµÐ· Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº Supabase'
            )
        })
    })

    describe('mockDeleteTask', () => {
        let taskId: string

        beforeEach(async () => {
            const result = await mockCreateTask(mockUserId, mockTaskData)
            taskId = result.task?.id || ''
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ Ð·Ð°Ð´Ð°Ñ‡Ñƒ', async () => {
            const result = await mockDeleteTask(taskId)

            expect(result.success).toBe(true)
            expect(result.message).toBe('Mock Ð·Ð°Ð´Ð°Ñ‡Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾')

            const userTasks = getMockTasksByUser(mockUserId)
            expect(userTasks).toHaveLength(0)
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÑƒ Ð´Ð»Ñ Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸', async () => {
            const result = await mockDeleteTask('non-existent-id')

            expect(result.success).toBe(false)
            expect(result.error).toBe('Ð—Ð°Ð´Ð°Ñ‡Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°')
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', async () => {
            await mockDeleteTask(taskId)

            expect(mockConsoleLog).toHaveBeenCalledWith(
                'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð±ÐµÐ· Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº Supabase'
            )
        })
    })

    describe('mockCompleteTask', () => {
        let taskId: string

        beforeEach(async () => {
            const result = await mockCreateTask(mockUserId, mockTaskData)
            taskId = result.task?.id || ''
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ', async () => {
            const actualMinutes = 25
            const result = await mockCompleteTask(taskId, actualMinutes)

            expect(result.success).toBe(true)
            expect(result.task?.status).toBe('completed')
            expect(result.task?.completedAt).toBeInstanceOf(Date)
            expect(result.task?.actualMinutes).toBe(actualMinutes)
            expect(result.message).toBe('Mock Ð·Ð°Ð´Ð°Ñ‡Ð° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾')
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ estimatedMinutes ÐµÑÐ»Ð¸ actualMinutes Ð½Ðµ ÑƒÐºÐ°Ð·Ð°Ð½', async () => {
            const result = await mockCompleteTask(taskId)

            expect(result.success).toBe(true)
            expect(result.task?.status).toBe('completed')
            expect(result.task?.actualMinutes).toBe(mockTaskData.estimatedMinutes)
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ð±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¼ÐµÑ‚ÐºÑƒ updatedAt', async () => {
            const originalUpdatedAt = getMockTasksByUser(mockUserId)[0].updatedAt

            await new Promise(resolve => setTimeout(resolve, 10))

            await mockCompleteTask(taskId)

            const updatedTask = getMockTasksByUser(mockUserId)[0]
            expect(updatedTask.updatedAt.getTime()).toBeGreaterThan(originalUpdatedAt.getTime())
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð¾ÑˆÐ¸Ð±ÐºÑƒ Ð´Ð»Ñ Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸', async () => {
            const result = await mockCompleteTask('non-existent-id')

            expect(result.success).toBe(false)
            expect(result.error).toBe('Ð—Ð°Ð´Ð°Ñ‡Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°')
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', async () => {
            await mockCompleteTask(taskId)

            expect(mockConsoleLog).toHaveBeenCalledWith(
                'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð±ÐµÐ· Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº Supabase'
            )
        })
    })

    describe('mockGetTasksStats', () => {
        beforeEach(async () => {
            // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸
            await mockCreateTask(mockUserId, {
                title: 'Completed Task',
                description: 'Description',
                priority: 'high',
                estimatedMinutes: 30,
                tags: ['test']
            })

            await mockCreateTask(mockUserId, {
                title: 'In Progress Task',
                description: 'Description',
                priority: 'medium',
                estimatedMinutes: 45,
                tags: ['test']
            })

            await mockCreateTask(mockUserId, {
                title: 'Todo Task',
                description: 'Description',
                priority: 'low',
                estimatedMinutes: 20,
                tags: ['test']
            })

            // Ð—Ð°Ð²ÐµÑ€ÑˆÐ°ÐµÐ¼ Ð¾Ð´Ð½Ñƒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ
            const tasks = getMockTasksByUser(mockUserId)
            await mockCompleteTask(tasks[0].id, 25)
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½ÑƒÑŽ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð·Ð°Ð´Ð°Ñ‡', async () => {
            const result = await mockGetTasksStats(mockUserId)

            expect(result.success).toBe(true)
            expect(result.stats).toBeDefined()
            expect(result.stats?.total).toBe(3)
            expect(result.stats?.completed).toBe(1)
            expect(result.stats?.pending).toBe(2)
            expect(result.stats?.overdue).toBe(0) // ÐÐµÑ‚ Ð·Ð°Ð´Ð°Ñ‡ Ñ dueDate
            expect(result.stats?.completionRate).toBe(33) // 1 Ð¸Ð· 3 Ð·Ð°Ð´Ð°Ñ‡ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾
            expect(result.stats?.averageCompletionTime).toBe(25)
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð½ÑƒÐ»ÐµÐ²ÑƒÑŽ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÑƒ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð±ÐµÐ· Ð·Ð°Ð´Ð°Ñ‡', async () => {
            const result = await mockGetTasksStats('user-without-tasks')

            expect(result.success).toBe(true)
            expect(result.stats).toMatchObject({
                total: 0,
                completed: 0,
                pending: 0,
                overdue: 0,
                completionRate: 0,
                averageCompletionTime: 0
            })
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', async () => {
            await mockGetTasksStats(mockUserId)

            expect(mockConsoleLog).toHaveBeenCalledWith(
                'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð·Ð°Ð´Ð°Ñ‡ Ð±ÐµÐ· Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº Supabase'
            )
        })
    })

    describe('mockSyncTasks', () => {
        beforeEach(async () => {
            await mockCreateTask(mockUserId, mockTaskData)
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ Ð²ÑÐµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ', async () => {
            const result = await mockSyncTasks(mockUserId)

            expect(result.success).toBe(true)
            expect(result.tasks).toHaveLength(1)
            expect(result.tasks[0].userId).toBe(mockUserId)
            expect(result.message).toBe('Mock Ð·Ð°Ð´Ð°Ñ‡Ð¸ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾')
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', async () => {
            await mockSyncTasks(mockUserId)

            expect(mockConsoleLog).toHaveBeenCalledWith(
                'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð°Ð´Ð°Ñ‡ Ð±ÐµÐ· Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº Supabase'
            )
        })
    })

    describe('mockGetProductivityMetrics', () => {
        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ mock Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸', async () => {
            const result = await mockGetProductivityMetrics(mockUserId)

            expect(result).toBeDefined()
            expect(result?.date).toBeInstanceOf(Date)
            expect(result?.focusTimeMinutes).toBe(120)
            expect(result?.tasksCompleted).toBe(1)
            expect(result?.distractionsCount).toBe(3)
            expect(result?.productivityScore).toBe(75)
            expect(result?.mood).toBe('high')
            expect(result?.energyLevel).toBe('medium')
            expect(result?.userId).toBe(mockUserId)
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', async () => {
            await mockGetProductivityMetrics(mockUserId)

            expect(mockConsoleLog).toHaveBeenCalledWith(
                'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¼ÐµÑ‚Ñ€Ð¸Ðº Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð±ÐµÐ· Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº Supabase'
            )
        })
    })

    describe('mockGetAISuggestions', () => {
        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ mock Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð˜Ð˜', async () => {
            const result = await mockGetAISuggestions(mockUserId)

            expect(Array.isArray(result)).toBe(true)
            expect(result).toHaveLength(2)
            expect(result[0]).toMatchObject({
                id: 'mock-suggestion-1',
                type: 'task_prioritization',
                title: 'Ð¡Ñ„Ð¾ÐºÑƒÑÐ¸Ñ€ÑƒÐ¹Ñ‚ÐµÑÑŒ Ð½Ð° ÑÑ€Ð¾Ñ‡Ð½Ñ‹Ñ… Ð·Ð°Ð´Ð°Ñ‡Ð°Ñ…',
                description: 'Ð£ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ 2 ÑÑ€Ð¾Ñ‡Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð½ÐµÐ¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾Ð³Ð¾ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ',
                actionText: 'ÐŸÐ¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ ÑÑ€Ð¾Ñ‡Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸',
                priority: 1,
                userId: mockUserId
            })
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ', async () => {
            const result = await mockGetAISuggestions('other-user')

            expect(result).toHaveLength(0)
        })

        it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', async () => {
            await mockGetAISuggestions(mockUserId)

            expect(mockConsoleLog).toHaveBeenCalledWith(
                'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¹ Ð˜Ð˜ Ð±ÐµÐ· Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº Supabase'
            )
        })
    })

    describe('Ð’ÑÐ¿Ð¾Ð¼Ð¾Ð³Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸', () => {
        describe('clearMockTasks', () => {
            it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ Ð²ÑÐµ mock Ð·Ð°Ð´Ð°Ñ‡Ð¸', async () => {
                await mockCreateTask(mockUserId, mockTaskData)
                expect(getMockTasksByUser(mockUserId)).toHaveLength(1)

                clearMockTasks()
                expect(getMockTasksByUser(mockUserId)).toHaveLength(0)
            })

            it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', () => {
                clearMockTasks()

                expect(mockConsoleLog).toHaveBeenCalledWith(
                    'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° mock Ð·Ð°Ð´Ð°Ñ‡'
                )
            })
        })

        describe('addMockTask', () => {
            it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð² mock Ð´Ð°Ð½Ð½Ñ‹Ðµ', () => {
                const task: Task = {
                    id: 'test-task',
                    title: 'Test Task',
                    description: 'Test Description',
                    priority: 'high',
                    status: 'todo',
                    estimatedMinutes: 30,
                    source: 'manual',
                    tags: ['test'],
                    userId: mockUserId,
                    createdAt: new Date(),
                    updatedAt: new Date()
                }

                addMockTask(task)
                expect(getMockTasksByUser(mockUserId)).toHaveLength(1)
                expect(getMockTasksByUser(mockUserId)[0].id).toBe('test-task')
            })

            it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', () => {
                const task: Task = {
                    id: 'test-task',
                    title: 'Test Task',
                    description: 'Test Description',
                    priority: 'high',
                    status: 'todo',
                    estimatedMinutes: 30,
                    source: 'manual',
                    tags: ['test'],
                    userId: mockUserId,
                    createdAt: new Date(),
                    updatedAt: new Date()
                }

                addMockTask(task)

                expect(mockConsoleLog).toHaveBeenCalledWith(
                    'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ Ð·Ð°Ð´Ð°Ñ‡Ð¸'
                )
            })
        })

        describe('updateMockTasks', () => {
            it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²ÑÐµ mock Ð·Ð°Ð´Ð°Ñ‡Ð¸', () => {
                const tasks: Task[] = [
                    {
                        id: 'task-1',
                        title: 'Task 1',
                        description: 'Description 1',
                        priority: 'high',
                        status: 'todo',
                        estimatedMinutes: 30,
                        source: 'manual',
                        tags: ['test'],
                        userId: mockUserId,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        id: 'task-2',
                        title: 'Task 2',
                        description: 'Description 2',
                        priority: 'medium',
                        status: 'completed',
                        estimatedMinutes: 45,
                        source: 'manual',
                        tags: ['test'],
                        userId: mockUserId,
                        createdAt: new Date(),
                        updatedAt: new Date()
                    }
                ]

                updateMockTasks(tasks)
                expect(getMockTasksByUser(mockUserId)).toHaveLength(2)
            })

            it('Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ', () => {
                updateMockTasks([])

                expect(mockConsoleLog).toHaveBeenCalledWith(
                    'ðŸ§ª MOCK Ð Ð•Ð–Ð˜Ðœ: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ mock Ð·Ð°Ð´Ð°Ñ‡'
                )
            })
        })
    })
})
