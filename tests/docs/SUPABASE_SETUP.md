# Настройка Supabase для Personal Productivity AI

## Шаги настройки

### 1. Создание проекта в Supabase

1. Перейдите на [supabase.com](https://supabase.com)
2. Создайте новый проект
3. Выберите регион (рекомендуется ближайший к вашим пользователям)
4. Дождитесь создания проекта

### 2. Настройка базы данных

1. В панели Supabase перейдите в раздел "SQL Editor"
2. Выполните SQL скрипт из файла `supabase-schema.sql`:

```sql
-- Скопируйте и выполните содержимое файла supabase-schema.sql
```

### 3. Настройка переменных окружения

1. В панели Supabase перейдите в Settings > API
2. Скопируйте следующие значения:
   - Project URL
   - anon public key

3. Создайте файл `.env.local` в корне проекта:

```env
NEXT_PUBLIC_SUPABASE_URL=your_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
```

### 4. Настройка Row Level Security (RLS)

Политики безопасности уже настроены в SQL скрипте:

- **Чтение**: Только для аутентифицированных пользователей
- **Вставка**: Разрешена всем (для подписки)
- **Обновление**: Только для аутентифицированных пользователей

### 5. Тестирование

1. Запустите проект: `npm run dev`
2. Откройте http://localhost:3000
3. Попробуйте подписаться на уведомления
4. Проверьте в Supabase Dashboard > Table Editor > subscriptions

## Структура таблицы subscriptions

| Поле | Тип | Описание |
|------|-----|----------|
| id | UUID | Уникальный идентификатор |
| email | VARCHAR(255) | Email подписчика |
| source | VARCHAR(100) | Источник подписки |
| subscribed_at | TIMESTAMP | Время подписки |
| is_active | BOOLEAN | Активна ли подписка |
| created_at | TIMESTAMP | Время создания записи |
| updated_at | TIMESTAMP | Время последнего обновления |

## API Endpoints

### POST /api/subscribe

Добавление нового подписчика.

**Запрос:**
```json
{
  "email": "user@example.com"
}
```

**Ответ (успех):**
```json
{
  "success": true,
  "message": "Спасибо за подписку! Мы уведомим вас о релизе.",
  "data": {
    "id": "uuid",
    "email": "user@example.com",
    "source": "landing_page",
    "subscribed_at": "2024-01-01T00:00:00Z",
    "is_active": true
  }
}
```

**Ответ (ошибка):**
```json
{
  "success": false,
  "error": "Этот email уже подписан на уведомления"
}
```

## Мониторинг и аналитика

В Supabase Dashboard вы можете:

1. Просматривать все подписки в Table Editor
2. Создавать SQL запросы для аналитики
3. Настраивать уведомления о новых подписках
4. Экспортировать данные

## Безопасность

- Все данные защищены RLS политиками
- Email адреса уникальны (предотвращает дублирование)
- Автоматическое обновление timestamp полей
- Логирование всех операций

## Масштабирование

При росте количества подписчиков рекомендуется:

1. Настроить индексы для оптимизации запросов
2. Использовать Supabase Edge Functions для обработки
3. Настроить автоматические бэкапы
4. Мониторить производительность запросов
